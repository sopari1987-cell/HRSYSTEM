<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <style>
      /* --- XERO STYLE THEME --- */
      body {
        font-family: 'Source Sans Pro', sans-serif;
        background-color: #ecf0f5;
        font-size: 14px;
        overflow-x: hidden;
      }

      /* LOGIN PAGE */
      #login-page {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(135deg, #5d69bc 0%, #a1887f 50%, #c62828 100%);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .login-box {
        width: 360px;
        background: rgba(255,255,255,0.15);
        padding: 30px;
        border-radius: 5px;
        color: #fff;
        text-align: left;
      }
      .login-header h2 { font-weight: 300; margin-bottom: 10px; }
      .login-header h4 { font-weight: 700; margin-bottom: 30px; }
      .login-input {
        background: #fff;
        border: none;
        height: 45px;
        margin-bottom: 15px;
        padding-left: 15px;
        width: 100%;
        border-radius: 3px;
      }
      .btn-login {
        width: 100%;
        background-color: #5cb85c;
        border: none;
        color: white;
        height: 45px;
        font-weight: bold;
        border-radius: 3px;
      }
      .btn-forgot {
        width: 100%;
        background-color: #f0ad4e;
        border: none;
        color: white;
        height: 40px;
        font-weight: bold;
        margin-top: 10px;
        border-radius: 3px;
      }

      /* MAIN LAYOUT (Hidden by default) */
      #app-layout { display: none; }

      /* HEADER */
      .main-header {
        background: linear-gradient(to right, #5c6bc0, #8d6e63, #c62828);
        height: 50px;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 20px;
        color: white;
      }
      .logo-lg { font-weight: bold; font-size: 20px; }

      /* SIDEBAR */
      .main-sidebar {
        background-color: #222d32;
        width: 230px;
        position: fixed;
        top: 50px;
        bottom: 0;
        left: 0;
        padding-top: 20px;
        color: #b8c7ce;
      }
      .user-panel {
        padding: 10px;
        display: flex;
        align-items: center;
        border-bottom: 1px solid #444;
        margin-bottom: 15px;
      }
      .user-panel img {
        border-radius: 50%;
        width: 45px;
        height: 45px;
        margin-right: 10px;
      }
      .sidebar-menu { list-style: none; padding: 0; margin: 0; }
      .sidebar-menu li { border-bottom: 1px solid #2a373e; }
      .sidebar-menu li a {
        display: block;
        padding: 12px 20px;
        color: #b8c7ce;
        text-decoration: none;
      }
      .sidebar-menu li a:hover, .sidebar-menu li a.active {
        background-color: #1e282c;
        color: #fff;
        border-left: 3px solid #3c8dbc;
      }
      .sidebar-menu .treeview-menu {
        display: none; /* JS will toggle this */
        background: #2c3b41;
        padding-left: 20px;
      }
      .sidebar-menu .treeview-menu a { font-size: 13px; }

      /* CONTENT WRAPPER */
      .content-wrapper {
        margin-left: 230px;
        margin-top: 50px;
        padding: 20px;
        min-height: 100vh;
      }

      /* CARDS & UTILS */
      .card-box {
        background: #fff;
        border-top: 3px solid #d2d6de;
        box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        border-radius: 3px;
      }
      .card-header {
        background-color: #f4f4f4;
        padding: 10px 15px;
        border-bottom: 1px solid #f4f4f4;
        font-weight: bold;
        color: #444;
      }
      .card-body { padding: 20px; }
      .page-title { margin-bottom: 15px; font-size: 24px; color: #444; }
      
      /* TABLES (Red header style from screenshot) */
      .table-xero thead {
        background-color: #d9534f; /* Reddish brown */
        color: white;
        font-size: 12px;
        text-align: center;
      }
      .table-xero th, .table-xero td {
        vertical-align: middle !important;
        font-size: 13px;
        border: 1px solid #ddd;
      }
      .weekend-row { background-color: #f9d6d5; } /* Light red for weekends */

      /* HELPERS */
      .d-none { display: none !important; }
      .required { color: red; }
    </style>
  </head>
  <body>

    <div id="login-page">
      <div class="login-box">
        <div class="login-header">
          <h2>Xero</h2>
          <h4>Sign in to your account</h4>
        </div>
        <form onsubmit="handleLogin(event)">
          <input type="text" id="email" class="login-input" placeholder="Username / Email" value="user@test.com">
          <input type="password" id="password" class="login-input" placeholder="Password" value="password">
          <button type="submit" class="btn-login">SIGN IN</button>
          <button type="button" class="btn-forgot">FORGOT PASSWORD</button>
          <small style="display:block; margin-top:10px; opacity:0.8;">Username & Password are case sensitive</small>
          <div id="login-error" class="mt-2 text-warning" style="display:none;"></div>
        </form>
      </div>
    </div>

    <div id="app-layout">
      
      <header class="main-header">
        <div class="d-flex align-items-center">
          <i class="fas fa-bars mr-3" style="cursor:pointer;"></i>
          <span class="logo-lg">Xero HRMS</span>
        </div>
        <div class="d-flex align-items-center">
          <i class="fas fa-bell mr-4"></i>
          <div class="d-flex align-items-center">
            <span class="mr-2" id="header-username">User</span>
            <i class="fas fa-user-circle fa-lg"></i>
          </div>
        </div>
      </header>

      <aside class="main-sidebar">
        <div class="user-panel">
          <img src="https://via.placeholder.com/45" alt="User Image">
          <div>
            <div id="sidebar-name" style="font-weight:600; color:#fff;">Loading...</div>
            <div style="font-size:11px;"><i class="fa fa-circle text-success"></i> Online</div>
          </div>
        </div>
        <ul class="sidebar-menu">
          <li class="header" style="padding: 10px 20px; font-size: 12px; background: #1a2226;">NAVIGATION</li>
          <li><a href="#" onclick="showPage('dashboard')"><i class="fa fa-tachometer-alt mr-2"></i> <span>Dashboard</span></a></li>
          
          <li class="active">
            <a href="#" onclick="toggleMenu('ess-menu')"><i class="fa fa-user mr-2"></i> <span>Employee Self Service</span> <i class="fa fa-angle-left float-right"></i></a>
            <ul class="treeview-menu" id="ess-menu" style="display:block;">
              <li><a href="#" onclick="showPage('attendance')"><i class="far fa-circle mr-2"></i> My Attendance</a></li>
              <li><a href="#" onclick="showPage('request-progress')"><i class="far fa-circle mr-2"></i> Request Progress</a></li>
              <li><a href="#" onclick="showPage('leave')"><i class="far fa-circle mr-2"></i> Leave Request</a></li>
              <li><a href="#" onclick="showPage('overtime')"><i class="far fa-circle mr-2"></i> Overtime Request</a></li>
              <li><a href="#" onclick="showPage('permit')"><i class="far fa-circle mr-2"></i> Permit Request</a></li>
              <li><a href="#" onclick="showPage('payslip')"><i class="far fa-circle mr-2"></i> Payslip History</a></li>
            </ul>
          </li>
          <li><a href="#" onclick="logout()"><i class="fa fa-sign-out-alt mr-2"></i> <span>Sign Out</span></a></li>
        </ul>
      </aside>

      <div class="content-wrapper">
        
        <div id="page-dashboard" class="page-section">
          <div class="row">
            <div class="col-md-8">
              <div class="card-box">
                <div class="card-header">Attendance Check In</div>
                <div class="card-body text-center" style="padding: 50px;">
                  <h4>Welcome to HRMS Zero, <span class="user-display-name"></span>.</h4>
                  <p class="text-muted">Server Time: <span id="server-time"></span></p>
                  <div class="alert alert-success d-inline-block">
                    Check in time: <strong>--:--</strong>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card-box">
                <div class="card-header">My Leave Balance</div>
                <div class="card-body">
                  <select class="form-control mb-3"><option>Annual Leave</option></select>
                  <div class="d-flex justify-content-between">
                    <span>Used: 0</span>
                    <span>Remaining: 12</span>
                  </div>
                  <div class="progress mt-2" style="height: 5px;">
                    <div class="progress-bar bg-success" style="width: 0%"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="page-attendance" class="page-section d-none">
          <h3 class="page-title">My Attendance</h3>
          
          <div class="card-box">
            <div class="card-header">Search Condition</div>
            <div class="card-body">
              <div class="form-row">
                <div class="col">
                  <label>From <span class="required">*</span></label>
                  <input type="date" class="form-control" value="2025-11-01">
                </div>
                <div class="col">
                  <label>Until <span class="required">*</span></label>
                  <input type="date" class="form-control" value="2025-11-30">
                </div>
              </div>
              <button class="btn btn-success mt-3 float-right" onclick="loadAttendance()">Search</button>
              <div class="clearfix"></div>
            </div>
          </div>

          <div class="card-box">
             <div class="card-header d-flex justify-content-between align-items-center">
                <span>Attendance for 11/2025</span>
                <button class="btn btn-sm btn-success">Download PDF</button>
             </div>
             <div class="card-body p-0 table-responsive">
               <table class="table table-xero mb-0">
                 <thead>
                   <tr>
                     <th rowspan="2">Date</th>
                     <th colspan="4">Work Time</th>
                     <th colspan="4">Late / Early</th>
                     <th colspan="4">Overtime</th>
                   </tr>
                   <tr>
                     <th>In</th> <th>Out</th> <th>Break</th> <th>Total</th>
                     <th>Early In</th> <th>Early Out</th> <th>Late In</th> <th>Late Out</th>
                     <th>Start</th> <th>End</th> <th>Break</th> <th>Total</th>
                   </tr>
                 </thead>
                 <tbody id="attendance-tbody">
                   <tr><td colspan="13" class="text-center">Loading...</td></tr>
                 </tbody>
               </table>
             </div>
          </div>
        </div>

        <div id="page-leave" class="page-section d-none">
           <h3 class="page-title">Leave Request</h3>
           <div class="card-box">
             <div class="card-header">Form Request</div>
             <div class="card-body">
                <form id="form-leave" onsubmit="submitForm(event, 'leave')">
                  <div class="form-group row">
                    <label class="col-sm-2 col-form-label">Leave Item <span class="required">*</span></label>
                    <div class="col-sm-10">
                      <select class="form-control" name="type">
                        <option>-- Select --</option>
                        <option value="1">Annual Leave</option>
                        <option value="2">Sick Leave</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-2 col-form-label">From <span class="required">*</span></label>
                    <div class="col-sm-4">
                      <input type="date" class="form-control" name="start">
                    </div>
                    <label class="col-sm-2 col-form-label">Until <span class="required">*</span></label>
                    <div class="col-sm-4">
                      <input type="date" class="form-control" name="end">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-sm-2 col-form-label">Reason</label>
                    <div class="col-sm-10">
                      <textarea class="form-control" rows="3" name="reason"></textarea>
                    </div>
                  </div>
                  <hr>
                  <div class="text-right">
                    <button type="button" class="btn btn-warning text-white">Save as Draft</button>
                    <button type="submit" class="btn btn-success">Process</button>
                  </div>
                </form>
             </div>
           </div>
        </div>

        <div id="page-overtime" class="page-section d-none">
          <h3 class="page-title">Overtime Request</h3>
          <div class="card-box">
            <div class="card-body">
               <form id="form-overtime" onsubmit="submitForm(event, 'overtime')">
                 <div class="form-group"><label>Date</label><input type="date" class="form-control"></div>
                 <div class="form-group"><label>Activity</label><textarea class="form-control"></textarea></div>
                 <div class="row">
                   <div class="col"><label>Start</label><input type="time" class="form-control"></div>
                   <div class="col"><label>End</label><input type="time" class="form-control"></div>
                 </div>
                 <button type="submit" class="btn btn-success mt-3 float-right">Submit</button>
               </form>
            </div>
          </div>
        </div>
        
        <div id="page-payslip" class="page-section d-none">
           <h3 class="page-title">Payslip History</h3>
           <div class="card-box">
             <div class="card-body">
               <div class="form-group row">
                 <label class="col-sm-2">Year</label>
                 <div class="col-sm-4">
                   <select class="form-control"><option>2025</option></select>
                 </div>
                 <div class="col-sm-2"><button class="btn btn-success">Search</button></div>
               </div>
               <table class="table table-striped mt-3">
                 <thead>
                   <tr style="background:#f5f5f5"><th>Period</th><th>Payslip</th></tr>
                 </thead>
                 <tbody>
                   <tr><td>October 2025</td><td><button class="btn btn-sm btn-success"><i class="fa fa-file-alt"></i> Monthly Payroll</button></td></tr>
                   <tr><td>September 2025</td><td><button class="btn btn-sm btn-success"><i class="fa fa-file-alt"></i> Monthly Payroll</button></td></tr>
                 </tbody>
               </table>
             </div>
           </div>
        </div>

      </div> </div> <script>
      // -- GLOBAL STATE --
      let currentUser = null;

      // 1. LOGIN LOGIC
      function handleLogin(e) {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const btn = document.querySelector('.btn-login');
        
        btn.innerText = "Verifying...";
        btn.disabled = true;

        // Call Google Script Backend
        google.script.run.withSuccessHandler(function(response) {
          if (response.status === 'success') {
            currentUser = response.data;
            initializeDashboard();
          } else {
            document.getElementById('login-error').style.display = 'block';
            document.getElementById('login-error').innerText = response.message;
            btn.innerText = "SIGN IN";
            btn.disabled = false;
          }
        }).loginUser(email, password);
      }

      // 2. DASHBOARD SETUP
      function initializeDashboard() {
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('app-layout').style.display = 'block';
        
        // Set User Info
        document.getElementById('header-username').innerText = currentUser.name;
        document.getElementById('sidebar-name').innerText = currentUser.name;
        
        const nameElements = document.getElementsByClassName('user-display-name');
        for(let el of nameElements) el.innerText = currentUser.name.toUpperCase();

        // Set Clock
        setInterval(() => {
          document.getElementById('server-time').innerText = new Date().toLocaleString();
        }, 1000);
      }

      // 3. NAVIGATION LOGIC
      function showPage(pageId) {
        // Hide all sections
        const sections = document.getElementsByClassName('page-section');
        for (let sec of sections) sec.classList.add('d-none');
        
        // Show target
        const target = document.getElementById('page-' + pageId);
        if (target) target.classList.remove('d-none');

        // Special Loader for Attendance
        if (pageId === 'attendance') loadAttendance();
      }

      function toggleMenu(menuId) {
        const menu = document.getElementById(menuId);
        menu.style.display = (menu.style.display === 'none') ? 'block' : 'none';
      }

      function logout() {
        location.reload();
      }

      // 4. DATA LOADING (MOCKUP FOR UI DEMO)
      function loadAttendance() {
        const tbody = document.getElementById('attendance-tbody');
        tbody.innerHTML = '<tr><td colspan="13" class="text-center">Loading data from Sheets...</td></tr>';
        
        google.script.run.withSuccessHandler(function(data) {
          tbody.innerHTML = '';
          if(data.length === 0) {
             tbody.innerHTML = '<tr><td colspan="13" class="text-center">No Data Found</td></tr>';
             return;
          }

          data.forEach(row => {
            const isWeekend = row.date.includes('Sat') || row.date.includes('Sun'); // Simple check logic need improvement
            const tr = document.createElement('tr');
            if(isWeekend) tr.classList.add('weekend-row');
            
            tr.innerHTML = `
              <td>${row.date}</td>
              <td>${row.in}</td><td>${row.out}</td><td>60</td><td>-</td>
              <td>-</td><td>-</td><td>-</td><td>-</td>
              <td>-</td><td>-</td><td>-</td><td>-</td>
            `;
            tbody.appendChild(tr);
          });
        }).getAttendanceLog(currentUser.id, 11, 2025);
      }

      // 5. FORM SUBMISSION
      function submitForm(e, type) {
        e.preventDefault();
        if(!confirm("Are you sure want to submit this request?")) return;
        
        // Collect generic data
        const data = {
           empId: currentUser.id,
           type: type,
           // In real app, grab specific fields by ID
           reason: "Demo Request" 
        };

        google.script.run.withSuccessHandler(function(res){
          alert(res.message);
          document.getElementById('form-'+type).reset();
        }).submitRequest(type, data);
      }

    </script>
  </body>
</html>
